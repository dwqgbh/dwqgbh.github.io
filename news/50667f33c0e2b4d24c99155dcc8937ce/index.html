<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="keywords" content=""/>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <link rel="icon" href="./../../themes/halo_quickstarter/source/images/favicon.ico" type="image/x-icon" />
	<link rel="stylesheet" type="text/css" href="./../../themes/halo_quickstarter/source/plug/css.css">
	<link rel="stylesheet" href="./../../themes/halo_quickstarter/source/css/kico.css"/>
	<link rel="stylesheet" href="./../../themes/halo_quickstarter/source/css/hingle.css"/>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
	<script type="text/javascript" src="./../../themes/halo_quickstarter/source/js/jquery.min.js"></script>
	<script type="text/javascript" src="./../../themes/halo_quickstarter/source/js/js.js"></script>
	<script type="text/javascript" src="./../../themes/halo_quickstarter/source/js/Top.js"></script>
	<script type="text/javascript" src="./../../themes/halo_quickstarter/source/js/time.js"></script>
	<script type="text/javascript" src="./../../themes/halo_quickstarter/source/js/count.js"></script>
	<!--script type="text/javascript" src="//api.html5media.info/1.2.2/html5media.min.js"></script-->
	<script type="text/javascript" id="wow"></script> 
	<script>
		$(function(){
			$(".li5").click(function() {
				$("html,body").animate({scrollTop:0}, 1000);
			});
		})
	</script>
    <meta name="generator" content="Halo 1.5.4"/>
    

    <meta name="referrer" content="never"><title>苹果设备的“锁屏漏洞”:CVE-2025-24200如何被攻击者利用? 展会快讯</title>
</head>
<!--##单页模块##-->
<body style="background-color: #ffffff">

<!--##pagetop##-->
<div class="header">
	<div class=" juzhong hidden-xs por DingBu" style="background-image:url(./../../upload/images/PcHead.jpg);background-color: #ced3d6;">
	</div>
</div>
<div id="nav-bar" class="clearfix">



	<div class="M-Nav" id="logo"> 
		<a href="#" class="Logo visible-xs"><img src="./../../upload/images/PhoneHead.jpg" alt="2023大湾区工博会- DMP大湾区工业博览会-深圳工博会"></a> 
	</div>
	<a href="javascript:;" class="M-Nav-btn"><div id="ToIndex"></div></a>
	<a href="./../.."  class="M-Nav-btn"><div id="ToIndex02"></div></a>
	<div id="nav">
			<ul>
			<li><a href="./../../index.html" target="_self">首页</a>
			</li>
			<li><a href="./../50667f33c0e2b4d24c99155dcc8937ce####/index.html" target="_self">关于展会</a>
			 <div class='nav-down-list'>
				 <ul>
					<li><a href="./../../s/exhibition-summary/index.html" target="_self">展会介绍</a></li>
					<li><a href="./../../s/exhibition-hall/index.html" target="_self">展馆介绍</a></li>
					<li><a href="./../../s/中部工博会/index.html" target="_self">南昌工博会</a></li>
					<li><a href="./../../s/福州工博会/index.html" target="_self">福州工博会</a></li>
					<li><a href="./../../api/DMP香港工博会2023.pdf" target="_blank">香港工博会</a></li>
					<li><a href="/xt/cn/" target="_blank">展会展期</a></li>
				</ul>
			</div>
			</li>
			<li><a href="./../50667f33c0e2b4d24c99155dcc8937ce####/index.html" target="_self">参展商</a>
			 <div class='nav-down-list'>
				 <ul>
					<li><a href="./../../categories/brand/index.html" target="_self">品牌榜</a></li>
					<li><a href="https://admin.dwqgbh.cn/nav/guestbook.htm" target="_self">展位申请</a></li>
				</ul>
			</div>
			</li>
			<li><a href="./../../categories/index.html" target="_self">新闻中心</a>
			 <div class='nav-down-list'>
				 <ul>
					<li><a href="./../../categories/message/index.html" target="_self">信息发布</a></li>
					<li><a href="./../../media/index.html" target="_self">媒体聚焦</a></li>
					<li><a href="./../index.html" target="_self">展会快讯</a></li>
					<li><a href="//tech.dwqgbh.cn/news/" target="_self">科技前沿资讯</a></li>
				</ul>
			</div>
			</li>
			<li><a href="./../../s/about/index.html" target="_self">关于我们</a>
			</li>
			<li><a href="./../50667f33c0e2b4d24c99155dcc8937ce####/index.html" target="_self">联系我们</a>
			 <div class='nav-down-list'>
				 <ul>
					<li><a href="https://admin.dwqgbh.cn/nav/guestbook.htm" target="_self">展位申请</a></li>
					<li><a href="./../../s/individual/index.html" target="_self">观众报名</a></li>
					<li><a href="./../.." target="_self">✆137-6147-0961</a></li>
					<li><a href="mailto:1301150027@qq.com" target="_self">1301150027@qq.com</a></li>
				</ul>
			</div>
			</li>
			</ul>
	</div>


</div>
<div class="nav-bar-height visible-xs"></div>


<main>
    <div class="wrap min">
               
    <h2 style="text-align:center">苹果设备的“锁屏漏洞”:CVE-2025-24200如何被攻击者利用? </h2>
   <p style="text-align:center">山石网科安全技术研究院  2025-03-08</p>
   <article class="post-content">
   
    <section><section><img alt="图片" data-backh="175.86666" data-backw="543.86666" data-cropselx1="0" data-cropselx2="542" data-cropsely1="0" data-cropsely2="311" data-imgfileid="100027236" data-ratio="0.3228200371057514" data-src="https://mmbiz.qpic.cn/sz_mmbiz_gif/NGIAw2Z6vnLzibrp7C4HmazCNIQXMJIRxvbibNMMmxDGrTN0Z9ibYzXnSNKobTzADCPgdo1b7ukKNARFEicHqQiajWw/640?wx_fmt=gif" data-type="gif" data-w="1078" class="src" src="./../../static/load.gif"/><br/></section></section><section><img alt="图片" data-backh="25" data-backw="546" data-imgfileid="100027176" data-ratio="0.04589371980676329" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/NGIAw2Z6vnLSsTccx7j0fJVU0OOoqKA8Jb8ZACqDjPdMzgicp2SzdZ19mFnVcBO53s1uA2cSfarQkwibVUeCeH9w/640?wx_fmt=png" data-type="other" data-w="828" class="src" src="./../../static/load.gif"/></section><p><br/></p><section><section><section><section><section><section><section><strong><span><strong><span>苹果设备的USB限制模式被绕过，你的隐私还安全吗？</span></strong></span></strong></section><section><section><strong/></section><section><strong/></section></section><section><p><img alt="图片" data-backh="7" data-backw="578" data-imgfileid="100027173" data-ratio="0.012962962962962963" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/NGIAw2Z6vnLKuKAwMiaYedpTAYugKibaTBsHzf5pDuztECgfIgOfpG5DRF31jzhosMEj23dlx186q0zgLaIZj9lA/640?wx_fmt=jpeg" data-type="other" data-w="1080" class="src" src="./../../static/load.gif"/></p></section></section></section></section><p><span><br/></span></p><p><span>在当今数字化时代，智能手机的安全性已经成为我们生活中不可或缺的一部分。苹果公司一直以其严格的安全机制著称，但最近一个名为CVE-2025-24200的漏洞却引发了广泛关注。接下来以一篇深度文章[1]，带你深入了解这个漏洞的细节，以及苹果是如何修复它的</span><span>。</span></p><p><span><br/></span></p><section><span><img alt="图片" data-backh="49" data-backw="546" data-imgfileid="100027174" data-ratio="0.09074074074074075" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/NGIAw2Z6vnLSsTccx7j0fJVU0OOoqKA8lvpAJHElQA6DiaJniaZb0daO3Kppz9ndV9Z2hHsjMuH61r2hu0jesGSg/640?wx_fmt=png" data-type="other" data-w="1080" class="src" src="./../../static/load.gif"/></span></section><section><span><strong><span>一、引言</span></strong></span></section><section><br/></section><p><span>苹果公司近日发布了iOS18.3.1版本（构建号22D72），用于修复由CitizenLab报告、涉及辅助功能框架的漏洞。相关的</span><span>漏洞公告可在此处[2]查阅。以下是直接从苹果官网摘录的概述：</span></p></section></section><ul><li><section><span>辅助功能漏洞影响设备：iPhoneXS及后续机型；13英寸iPadPro；第三代及后续12.9英寸iPadPro；第一代及后续11英寸iPadPro；第三代及后续iPadAir；第七代及后续iPad；第五代及后续iPadmini。</span></section></li><li><section><span>漏洞影响：物理攻击可能导致锁定设备的USB限制模式被禁用。苹果已获悉一份报道称，该漏洞可能已被利用于针对特定目标的极其复杂的攻击中。</span></section></li><li><section><span>漏洞描述：通过改进状态管理机制解决了授权问题。</span></section></li><li><section><span>CVE-2025-24200：多伦多大学蒙克学院CitizenLab的BillMarczak</span></section></li></ul><section><span><br/></span></section><section><span>在笔者的文章中，主要是阐述目前从补丁中所了解到的</span><span>。</span></section><section><span><br/></span></section><section><section><section><span><img alt="图片" data-backh="49" data-backw="546" data-imgfileid="100027175" data-ratio="0.09074074074074075" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/NGIAw2Z6vnLSsTccx7j0fJVU0OOoqKA8lvpAJHElQA6DiaJniaZb0daO3Kppz9ndV9Z2hHsjMuH61r2hu0jesGSg/640?wx_fmt=png" data-type="other" data-w="1080" class="src" src="./../../static/load.gif"/></span></section><section><span><strong><span>二、USB限制模式</span></strong></span></section><p><br/></p><p><span>在深入分析补丁之前，笔者先简要回顾USB限制模式的功能及其重要性。</span></p></section></section><p><span>当iPhone启用USB限制模式后，若设备处于锁定状态超过1小时，其端口的数据传输功能将被自动禁用。用户必须解锁设备并明确授权，外部配件才能建立连接：</span><p/></p><section><section><p><span><br/></span></p><p><img data-backh="129" data-backw="546" data-croporisrc="https://mmbiz.qpic.cn/mmbiz_jpg/Gw8FuwXLJnTj4JQQ7xCVXQvGzor2fwicZfbEgFibJp9oYic8KQoB4VwOt9A0LV7tneYJ1iaF7ibw9cu99ugHRkuibjtg/640?wx_fmt=jpeg" data-cropx1="0" data-cropx2="750" data-cropy1="405.2197802197802" data-cropy2="582.4175824175824" data-imgfileid="100027241" data-ratio="0.236" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/Gw8FuwXLJnRibZ73fZtsv5DVIhFKt5ktfAw0Vktve0M1ZWn0Kn66k3K7CbUONQoicRIjAVhk0H27RxBcicS12kzcQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="750" class="src" src="./../../static/load.gif"/></p><p><br/></p></section><section><span>这一机制的核心目标是抵御高复杂性物理攻击，特别是通过外接设备（如取证提取工具，例如ufed或graykey）。</span></section><section><span><br/></span></section><section><span>若攻击者能够从锁屏界面直接绕过USB限制模式，则意味着设备将重新暴露于上述风险中。近期社交媒体上的案例（如此推文[3]）也印证了攻击者对此类绕过能力的迫切需求：</span></section><section><span><br/></span></section><section><p><img data-backh="248" data-backw="578" data-imgfileid="100027242" data-ratio="0.42962962962962964" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/Gw8FuwXLJnTj4JQQ7xCVXQvGzor2fwicZric6vOHO6H2JSu9fytyIgu8PlMX31DnvB6zFahUlNU45xRxgAXSlQfQ/640?wx_fmt=png" data-type="png" data-w="1080" class="src" src="./../../static/load.gif"/><br/></p><p><br/></p></section><section><span>在接下来的章节中，笔者对CVE-2025-24200漏洞进行技术解析。该漏洞允许攻击者在特定条件下绕过USB限制模式。</span></section></section><section><section><p><span><br/></span></p><section><span><img alt="图片" data-backh="49" data-backw="546" data-imgfileid="100027178" data-ratio="0.09074074074074075" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/NGIAw2Z6vnLSsTccx7j0fJVU0OOoqKA8lvpAJHElQA6DiaJniaZb0daO3Kppz9ndV9Z2hHsjMuH61r2hu0jesGSg/640?wx_fmt=png" data-type="other" data-w="1080" class="src" src="./../../static/load.gif"/></span></section><section><span><strong><span>三、设置</span></strong></span></section><p><br/></p></section><p><span>在找到实际补丁之前，第一步是下载修复前后的iOS构建版本：</span></p></section><section><section data-tool="markdown编辑器" data-website="https://markdown.com.cn/editor"><pre data-tool="markdown.com.cn编辑器"><code><span>#</span><span> pre-patch</span><br/>ipsw download ipsw --device iPhone14,4 --build 22D63<br/><span><br/>#</span><span> post-patch</span><br/>ipsw download ipsw --device iPhone14,4 --build 22D72<br/></code></pre></section><p><span>接着，可以从两个版本中提取所有二进制文件和库以调查变更。</span></p></section><section><p><span><br/></span></p><section><span><img alt="图片" data-backh="49" data-backw="546" data-imgfileid="100027180" data-ratio="0.09074074074074075" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/NGIAw2Z6vnLSsTccx7j0fJVU0OOoqKA8lvpAJHElQA6DiaJniaZb0daO3Kppz9ndV9Z2hHsjMuH61r2hu0jesGSg/640?wx_fmt=png" data-type="other" data-w="1080" class="src" src="./../../static/load.gif"/></span></section><section><span><strong><span>四、定位补丁</span></strong></span></section><section><span><strong><span><br/></span></strong></span></section><p><span>笔者首先查看了由Blacktop为每个iOS版本生成并发布的</span><code>ipsw diff</code><span>差异报告。</span></p><p><span><br/></span></p></section><section><span>通过此报告，可以检查每个显著变化。值得注意的是，苹果在公告中提到改进了状态管理，这可能涉及额外的检查，并因此引入了新的基础块（basicblocks）。</span></section><section><span><br/></span></section><section><span>通过以下（无界面）BinaryNinja脚本，我们可以列出同一二进制文件两个符号化版本的基础块数量差异：</span></section><section><section data-tool="markdown编辑器" data-website="https://markdown.com.cn/editor"><pre data-tool="markdown.com.cn编辑器"><code><span>import</span> binaryninja<br/><br/>binaryninja.disable_default_log()<br/><br/><span><span>def</span> <span>build_table</span><span>(bv: binaryninja.BinaryView)</span>:</span><br/>    <span>"""Builds a table of function names to their basic block count."""</span><br/>    table = {}<br/>    <span>for</span> f <span>in</span> bv.functions:<br/>        <span>if</span> <span>not</span> f.name.startswith(<span>'sub_'</span>):<br/>            table[f.name] = [len(f.basic_blocks)]<br/>    <span>return</span> table<br/><br/><span><span>def</span> <span>diff_tables</span><span>(original, patched)</span>:</span><br/>    <span>"""Compares two basic block tables and prints changes."""</span><br/>    <span>for</span> fn <span>in</span> original.keys() & patched.keys():<br/>        <span>if</span> original[fn] != patched[fn]:<br/>            print(<span>f'<span>{fn}</span>: <span>{original[fn]}</span> -> <span>{patched[fn]}</span>'</span>)<br/><br/>t1 = build_table(binaryninja.load(<span>"/path/to/original"</span>))<br/>t2 = build_table(binaryninja.load(<span>"/path/to/patched"</span>))<br/><br/>diff_tables(t1, t2)<br/></code></pre></section><section><span>在接下来的子章节中，笔者重点分析两个组件中发现的重要变更。</span></section><p><br/></p></section><section><span><strong>（一）AXSpringBoardServerInstance 的变更</strong></span></section><section><img alt="图片" data-backh="23" data-backw="546" data-imgfileid="100027246" data-ratio="0.04259259259259259" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/NGIAw2Z6vnLSsTccx7j0fJVU0OOoqKA8WFHRW8Evk0zcqAPJSmSRktqm69UXCNGtz8L1sz1g1Wg3sEYViamG90Q/640?wx_fmt=png" data-type="other" data-w="1080" width="645px" class="src" src="./../../static/load.gif"/></section><p><span>在该框架中，以下函数似乎新增了<strong>4个基础块</strong>：</span></p><section data-tool="markdown编辑器" data-website="https://markdown.com.cn/editor"><pre data-tool="markdown.com.cn编辑器"><code>-[AXSpringBoardServerHelper _handleDisallowUSBRestrictedModeSCInformativeOnly:]</code></pre></section><p><span>进一步检查发现，苹果在函数的最开头添加了一个校验，确保设备在显示弹窗前已解锁。该弹窗的标题为本地化字符串</span><code>sc.disallow.usb.restricted.mode.alert.title</code><span/><span>，并仅包含一个可点击的</span><code>OK</code><span/><span>操作。</span></p><p><span><br/></span></p><p><span>顾名思义，此函数仅用于信息提示，即仅影响用户界面。我们仍需找到弹窗显示后实际禁用USB限制模式的位置。</span></p><section><section><p><br/></p></section><section><span><strong>（二）</strong></span><strong><span>profiled的变更</span></strong></section><section><img alt="图片" data-backh="23" data-backw="546" data-imgfileid="100027248" data-ratio="0.04259259259259259" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/NGIAw2Z6vnLSsTccx7j0fJVU0OOoqKA8WFHRW8Evk0zcqAPJSmSRktqm69UXCNGtz8L1sz1g1Wg3sEYViamG90Q/640?wx_fmt=png" data-type="other" data-w="1080" width="645px" class="src" src="./../../static/load.gif"/></section><p><span>profiled是iOS中一个重要的守护进程，负责处理多项功能，包括辅助功能、远程设备管理（MDM）等，在此次更新中，以下函数被修补并新增了<strong>6个基础块</strong>：</span></p></section><section><section data-tool="markdown编辑器" data-website="https://markdown.com.cn/editor"><pre data-tool="markdown.com.cn编辑器"><code>-[MCProfileServicer setParametersForSettingsByType:configurationUUID:toSystem:user:passcode:credentialSet:completion:]<br/></code></pre></section><p><span>通过逆向工程两个版本，笔者还原了补丁内容如下：</span></p><section data-tool="markdown编辑器" data-website="https://markdown.com.cn/editor"><pre data-tool="markdown.com.cn编辑器"><span/><code>diff --git a/original.m b/patched.m<br/>index cd2b537..7fe1bd4 100644<br/><span>--- a/original.m</span><br/><span>+++ b/patched.m</span><br/>@@ -8,6 +8,13 @@ BOOL has_ent = [self<br/><br/>if (has_some_entitlement == NO) {<br/>    // Unchanged<br/>} else {<br/><span>+       NSDict *rb = [settingsByType objectForKeyedSubscript: @"RestrictedBool"];</span><br/><span>+       BOOL is_device_locked [[MCDependencyManager sharedManager] isDeviceLocked];</span><br/><span>+       BOOL restricted_mode_allowed = [</span><br/><span>+               rb objectForKeyedSubscript: @"FeatureUSBRestrictedModeAllowed"</span><br/><span>+       ]</span><br/><span>+</span><br/><span>+       if (restricted_mode_allowed == NO || is_device_locked == NO) {</span><br/><br/>               [[[MCProfileServiceServer sharedServer]]<br/>                       setParametersForSettingsByType: type<br/>                       sender: [self remoteProcessBundleID]<br/>                       completion: completion<br/>               ]<br/><span>+</span><br/><span>+       } else {</span><br/><span>+               NSError *error = [</span><br/><span>+                       MCErrorWithDomain: _MCSettingsErrorDomain</span><br/><span>+                       code: 0x6d66</span><br/><span>+                       descriptionArray: _MCErrorArray</span><br/><span>+                       errorType: _MCErrorTypeFatal</span><br/><span>+               ];</span><br/><span>+</span><br/><span>+               if (completion) {</span><br/><span>+                       completion.completionHandler(completion, error);</span><br/><span>+               }</span><br/><span>+       }</span><br/> }<br/></code></pre></section></section><section><span>正如看到的这样，在调用实际设置目标参数（本例中即限制模式状态）的</span><code>setParametersForSettingsByType</code><span>内部方法前，函数会校验设备是否已解锁。</span><span>这似乎是实际修复CVE-2025-24200的补丁。</span></section><section><section><br/></section><section><span><img alt="图片" data-backh="49" data-backw="546" data-imgfileid="100027181" data-ratio="0.09074074074074075" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/NGIAw2Z6vnLSsTccx7j0fJVU0OOoqKA8lvpAJHElQA6DiaJniaZb0daO3Kppz9ndV9Z2hHsjMuH61r2hu0jesGSg/640?wx_fmt=png" data-type="other" data-w="1080" class="src" src="./../../static/load.gif"/></span></section><section><span><strong><span>五、攻击向量分析</span></strong></span></section><section><span><strong><span><br/></span></strong></span></section><section><span>跟随笔者，现在我们对补丁有了更深入的理解，需要找到可利用底层漏洞的代码路径。第一步是确定如何通过前述两个修补函数之一来禁用USB限制模式。经研究发现，</span><code>assistivetouchd</code><span>守护进程包含通过以下函数禁用USB限制模式的代码：</span></section></section><section><section data-tool="markdown编辑器" data-website="https://markdown.com.cn/editor"><pre data-tool="markdown.com.cn编辑器"><code>-[SCATScannerManager _setUSBRMPreferenceDisabled]</code></pre></section></section><section><span>此函数引用了多个</span><code>AX[...]</code><span>类，暗示其可能与前面讨论的第一部分补丁（弹窗提示）相关。</span><span>这促使我们更仔细地研究该守护进程。</span></section><section><span><br/></span></section><section><section><span><strong>（一）</strong></span><strong><span>assistivetouchd守护进程</span></strong></section></section><section><section><img alt="图片" data-backh="23" data-backw="546" data-imgfileid="100027254" data-ratio="0.04259259259259259" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/NGIAw2Z6vnLSsTccx7j0fJVU0OOoqKA8WFHRW8Evk0zcqAPJSmSRktqm69UXCNGtz8L1sz1g1Wg3sEYViamG90Q/640?wx_fmt=png" data-type="other" data-w="1080" width="645px" class="src" src="./../../static/load.gif"/></section></section><section><code>assistivetouchd</code><span>守</span><span>护进程位于iOS设备的以下路径：</span></section><section data-tool="markdown编辑器" data-website="https://markdown.com.cn/editor"><pre data-tool="markdown.com.cn编辑器"><code>System/Library/CoreServices/AssistiveTouch.app/assistivetouchd</code></pre></section><section><span>当设备启用某些辅助功能时，该守护进程会持续在后台运行。最典型的例子是Assistive Touch功能——此功能会在屏幕上常驻一个菜单，允许用户通过菜单执行特定操作：</span></section><section><span><br/></span></section><section><img data-backh="113" data-backw="546" data-croporisrc="https://mmbiz.qpic.cn/mmbiz_png/Gw8FuwXLJnTj4JQQ7xCVXQvGzor2fwicZD8YZf2auX09Y2Bd1FqH9cegmMkDhicicPLIjHseCUDEuVRB85FW54Guw/640?wx_fmt=png" data-cropx1="89.17431192660551" data-cropx2="1080" data-cropy1="1378.4107007238179" data-cropy2="1582.8639625536666" data-imgfileid="100027256" data-ratio="0.20686175580222" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/Gw8FuwXLJnRibZ73fZtsv5DVIhFKt5ktfJy6BKHcJofEZRhvPPqcuqE2ByPicBX5VANuQ8nLBLHJP265FIR0jTibg/640?wx_fmt=jpeg" data-type="jpeg" data-w="991" class="src" src="./../../static/load.gif"/></section><section><br/></section><section><section><span>通过查看</span><code>assistivetouchd</code><span>的交叉引用，我们发现</span><code>_setUSBRMPreferenceDisabled</code><span/><span>可能由以下函数调用：</span></section></section><section data-tool="markdown编辑器" data-website="https://markdown.com.cn/editor"><pre data-tool="markdown.com.cn编辑器"><code>-[SCATScannerManager handleUSBMFiDeviceConnected]</code></pre></section><section><span>根据函数名推断，连接经过MFi认证（MadeforiPhone）的外设即可触发此函数。</span></section><section><span><br/></span></section><section><span>以下是该函数的逆向代码（可能存在误差）：</span></section><section><section data-tool="markdown编辑器" data-website="https://markdown.com.cn/editor"><pre data-tool="markdown.com.cn编辑器"><code><span><span>@implementation</span> <span>SCATScannerManager</span></span><br/><br/>- (<span>void</span>)handleUSBMFiDeviceConnected {<br/>    AXSettings btm = [SCATBluetoothManager sharedInstance];<br/><br/>    <span>bool</span> did_read_rm_alert = [btm switchControlUserDidReadUSBRestrictedModeAlert];<br/>    <span>bool</span> has_disabled_rm = [<span>self</span> userHasDisabledUSBRM];<br/>    <span>bool</span> should_disallow_rm = [btm switchControlShouldDisallowUSBRestrictedMode];<br/><br/>    <span>if</span> (!did_read_rm_alert && !has_disabled_rm && should_disallow_rm) {<br/>        [btm setSwitchControlShouldDisallowUSBRestrictedMode:<span>NO</span>];<br/><br/>        <span>// Forwards a call to the AXSettings framework that is responsible</span><br/>        <span>// for showing the alert discussed earlier in the patch section</span><br/><br/>        <span>// The -[SCATScannerManager _setUSBRMPreferenceDisabled] function that</span><br/>        <span>// disables USB restricted mode is passed as the callback handler for</span><br/>        <span>// this alert.</span><br/>    }<br/>}<br/><br/><span>@end</span></code></pre></section></section><section><span>函数内部会执行基础检查以决定是否显示弹窗。核心逻辑为：若弹窗未展示过且USB限制模式已启用，则触发弹窗。弹窗仅包含“确认”按钮，点击后会执行回调函数——即调用</span><span>_setUSBRMPreferenceDisabled</span><span>。</span></section><section><span><br/></span></section><section><section><span><strong>（二）手动触发函数测试</strong></span><strong/></section></section><section><strong/></section><section><section><img alt="图片" data-backh="23" data-backw="546" data-imgfileid="100027259" data-ratio="0.04259259259259259" data-s="300,640" data-type="other" data-w="1080" width="645px" data-src="https://mmbiz.qpic.cn/mmbiz_png/NGIAw2Z6vnLSsTccx7j0fJVU0OOoqKA8WFHRW8Evk0zcqAPJSmSRktqm69UXCNGtz8L1sz1g1Wg3sEYViamG90Q/640?wx_fmt=png" class="src" src="./../../static/load.gif"/></section></section></section><section><span>为验证假设，我们尝试在可通过Frida调试的iOS设备上强制调用</span><code>handleUSBMFiDeviceConnected</code><span>方法。</span></section><section><span><br/></span></section><section><span>不幸的是，我们无法直接通过Frida的ModuleAPI获取该函数，因此改用以下方式：通过命令从设备提取</span><code>assistivetouchd</code><span/><span>二进制文件：</span></section><section data-tool="markdown编辑器" data-website="https://markdown.com.cn/editor"><pre data-tool="markdown.com.cn编辑器"><section><span>frida-pull -U /System/Library/CoreServices/AssistiveTouch.app/assistivetouchd</span></section></pre></section><section><span>从二进制文件中，可以手动计算目标函数与可触发函数之间的偏移量。</span></section><section><span><br/></span></section><section><span>在这个案例中，笔者选择钩住</span><code>-[HNDRocker _shakePressed]</code><span>方法，是因为可在设备锁定时通过AssistiveTouch菜单触发。</span><span>onEnter</span><span>处理如下：</span></section><section><section data-tool="markdown编辑器" data-website="https://markdown.com.cn/editor"><pre data-tool="markdown.com.cn编辑器"><span/><code>onEnter(log, args, state) {<br/>    <span>// Following addresses need to be adapted for each build</span><br/>    shakePressedBaseAddr = <span>0x100042858</span>;<br/>    handleUSBMFiDeviceConnectedBaseAddr = <span>0x1000ad1c8</span>;<br/><br/>    off = handleUSBMFiDeviceConnectedBaseAddr - shakePressedBaseAddr<br/><br/>    shakePressedAddr = <span>this</span>.context.pc;<br/>    log(<span>'ShakePressed:'</span>, shakePressedAddr)<br/><br/>    handleUSBMFiDeviceConnectedAddr = shakePressedAddr.add(off)<br/>    log(<span>'handleUSBMFiDeviceConnected:'</span>, handleUSBMFiDeviceConnectedAddr)<br/><br/>    handle = <span>new</span> NativeFunction(handleUSBMFiDeviceConnectedAddr, <span>'long'</span>, []);<br/>    handle()<br/>},<br/></code></pre></section><section><span/></section><p><span>  追踪命令：</span></p><section data-tool="markdown编辑器" data-website="https://markdown.com.cn/editor"><pre data-tool="markdown.com.cn编辑器"><span/><code>frida-trace -U assistivetouchd -m <span>'-[HNDRocker _shakePressed]'</span><br/></code></pre></section><section><span/></section><section><p><span>最终，通过点击“Shake”选项触发了追踪函数。借助钩子，成功调用了</span><code>handleUSBMFiDeviceConnected</code><span>函数并显示弹窗：</span></p><section><span><span><br/></span></span></section><section><img data-backh="546" data-backw="546" data-imgfileid="100027263" data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/Gw8FuwXLJnTj4JQQ7xCVXQvGzor2fwicZv3ZZG92yptO8c0xcmRcPTGFwzbibOr9s0KOZaz5TyrZvxLrBekHje2A/640?wx_fmt=png" data-type="png" data-w="1080" class="src" src="./../../static/load.gif"/></section><section><span><span/></span></section><section><br/></section></section><section><section><span>如前所述，此时攻击者仅需点击“OK”即可在锁屏界面禁用USB限制模式。</span><span>本次测试基于以下设备环境：</span><span>iPhoneX（iPhone10,3），运行系统为iOS16.7.10（构建号20H350）。</span></section><section><span><br/></span></section><section><section><span><strong>（三）如何在真实场景中触发</strong></span><strong/></section></section><section><strong/></section><section><section><img alt="图片" data-backh="23" data-backw="546" data-imgfileid="100027264" data-ratio="0.04259259259259259" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/NGIAw2Z6vnLSsTccx7j0fJVU0OOoqKA8WFHRW8Evk0zcqAPJSmSRktqm69UXCNGtz8L1sz1g1Wg3sEYViamG90Q/640?wx_fmt=png" data-type="other" data-w="1080" width="645px" class="src" src="./../../static/load.gif"/></section></section><section><span/></section><section><span/></section></section><section><section><span>目前我们仅通过强制调用</span><code>-[SCATScannerManager handleUSBMFiDeviceConnected]</code><span>方法触发弹窗，但尚不清楚其在真实场景中的自然调用方式。</span></section><section><span><br/></span></section><section><span>需补充说明的是，AssistiveTouch并非唯一会激活</span><code>assistivetouchd</code><span>守护进程的辅助功能。</span><span>另一相关功能是切换控制（SwitchControl）。</span></section><section><span/></section><section><span><br/></span></section><section><span>该功能允许用户通过外接设备控制iPhone。</span><span>从当前分析的类方法命名——均以</span><code>SC</code><span>开头（可能代表SwitchControl）推断，插入通过MFi认证的切换控制设备是合法触发途径。</span><span>调研市面上的切换控制设备发现，多数通过蓝牙连接。</span><span>但我们发现曾有一款通过Lightning接口操作的设备。</span></section><section><span/></section><section><span><br/></span></section><section><span/></section><section><span>此处是来源于厂商网站的产品展示截图，标注的该产品已停产。</span></section><section><span><br/></span></section><section><img data-backh="388" data-backw="546" data-imgfileid="100027265" data-ratio="0.7101851851851851" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/Gw8FuwXLJnTj4JQQ7xCVXQvGzor2fwicZEgJTWT8ZWyicWe0q4JwsBPAoYDl4oeVYfBHoVpMlEjHuHbNUuoVdguw/640?wx_fmt=png" data-type="png" data-w="1080" class="src" src="./../../static/load.gif"/></section><section><span/></section></section><section><section><span/></section><section><span>当设备处于USB限制模式时，USB协议完全禁用，但Lightning端口仍支持其他协议，如MFi设备使用的iAP2协议。</span><span>因此推测：</span><span>在启用切换控制功能的iPhone上插入此类设备，可能直接触发弹窗，从而在iOS18.3.1之前的版本中在锁屏界面绕过USB限制模式</span><span>。</span></section><section><span><br/></span></section><section><section><section><section><section><span><img alt="图片" data-backh="49" data-backw="546" data-imgfileid="100027270" data-ratio="0.09074074074074075" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/NGIAw2Z6vnLSsTccx7j0fJVU0OOoqKA8lvpAJHElQA6DiaJniaZb0daO3Kppz9ndV9Z2hHsjMuH61r2hu0jesGSg/640?wx_fmt=png" data-type="other" data-w="1080" class="src" src="./../../static/load.gif"/></span></section><section><span><span><strong>六、免责声明</strong></span></span></section><section><span><strong><span><br/></span></strong></span></section></section></section></section></section><section><p><span>尽管上述推测逻辑可行，但我们目前缺乏硬件设备进行实际验证。</span><span>需注意，USB限制模式并非防御物理外设攻击的唯一机制，实际漏洞利用可能更为复杂。</span></p></section><p><span><br/></span></p><p><span>此外，本文仅探讨了该漏洞的一种潜在攻击向量，其他利用方式可能仍存在。强烈建议用户及时更新设备至最新系统版本，即使未启用辅助功能</span><span>。</span></p><section><span><br/></span></section></section></section><section><section><section><section><section><span><img alt="图片" data-imgfileid="100027196" data-ratio="0.09074074074074075" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/NGIAw2Z6vnLSsTccx7j0fJVU0OOoqKA8lvpAJHElQA6DiaJniaZb0daO3Kppz9ndV9Z2hHsjMuH61r2hu0jesGSg/640?wx_fmt=png" data-type="other" data-w="1080" class="src" src="./../../static/load.gif"/></span></section><section><span><strong><span>参考文献</span></strong></span></section><section><br/></section></section></section><p><span>[1]<span>https://blog.quarkslab.com/first-analysis-of-apples-usb-restricted-mode-bypass-cve-2025-24200.html.</span></span></p><p><span>[2]https://support.apple.com/en-ca/122174.</span></p><p><span>[3]https://x.com/zerozenxlabs/status/1889612599727096140.</span></p></section><p><span>[4]Activating data connections securely – Apple Support (UK),https://support.apple.com/en-gb/guide/security/sec5044aad1b/1/web/1.</span></p><p><span>[5]About the security content of iOS 18.3.1 and iPadOS 18.3.1 - Apple Support (CA),https://support.apple.com/en-ca/122174.</span></p><p><span>[6]Important info about the Blue2 and Hook+ switch interfaces (updated 4/8/24) | OMazing Kids AAC Consulting,https://omazingkidsllc.com/2022/06/30/important-info-about-the-blue2-and-hook-switch-interfaces/.</span></p><p><span>[7]stacksmashing - Hithackers guide to Apple Lightning and JTAG hacking - V02,https://media.defcon.org/DEF CON 30/DEF CON 30 presentations/stacksmashing - The hitchhackers guide to iPhone Lightning JTAG hacking.pdf.</span></p><section><span><br/></span></section><section><section><section><section><section data-width="100%"><section><section><section><section><section><section><img alt="图片" data-backh="25" data-backw="546" data-fileid="513766791" data-imgfileid="100027239" data-ratio="0.04589371980676329" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/NGIAw2Z6vnLSsTccx7j0fJVU0OOoqKA8KrXv9sZf93yt4huq2kARyZSgmdnic40GayohIYiaD2FAkkAqJehJSMtQ/640?wx_fmt=png" data-type="png" data-w="828" class="src" src="./../../static/load.gif"/></section></section></section></section></section></section><section><section><section><section><section data-width="100%"><section><span>山石网科是中国网络安全行业的技术创新领导厂商，由一批知名网络安全技术骨干于2007年创立，并以首批网络安全企业的身份，于2019年9月登陆科创板（股票简称：山石网科，股票代码：688030）。</span></section></section><section><section><section data-width="100%"><section><span>现阶段，山石网科掌握30项自主研发核心技术，申请540多项国内外专利。山石网科于2019年起，积极布局信创领域，致力于推动国内信息技术创新，并于2021年正式启动安全芯片战略。2023年进行自研ASIC安全芯片的技术研发，旨在通过自主创新，为用户提供更高效、更安全的网络安全保障。目前，山石网科已形成了具备“全息、量化、智能、协同”四大技术特点的涉及边界安全、云安全、数据安全、业务安全、内网安全、智能安全运营、安全服务、安全运维等八大类产品服务，50余个行业和场景的完整解决方案。</span></section></section></section><section><img alt="图片" data-backh="312.86666" data-backw="543.86666" data-cropselx1="0" data-cropselx2="544" data-cropsely1="0" data-cropsely2="313" data-fileid="513766792" data-imgfileid="100027240" data-ratio="0.5746061167747915" data-src="https://mmbiz.qpic.cn/sz_mmbiz_gif/NGIAw2Z6vnLzibrp7C4HmazCNIQXMJIRxPibycdiaNQCI4PNojUk3eYCQDZs6c5zNMUkq7yFNeYQIxicAV33eHNdFA/640?wx_fmt=gif" data-type="gif" data-w="1079" class="src" src="./../../static/load.gif"/></section></section></section></section></section></section></section></section></section></section></section></section><p><mp-style-type data-value="3"/></p> 
        
         </article>
   <script type="text/javascript" src="./../../nav/jquery.lazyload.src.js"></script>
   <script type="text/javascript" charset="utf-8">
  $(function() {
      $("img.src").lazyload({ placeholder : "./../../static/load.gif",effect: "fadeIn"});
  });
</script>

    </div>
</main>



    <div class="footer" style="background-color: #ced3d6">

            <div class="w80 juzhong">
                <img class="wybf" src="./../../upload/images/footzhuban.png" style="width: 100%;z-index:99">
              <img class="sjbf" src="./../../upload/images/footzhuban1.png" style="width: 100%;z-index:99">
                    <p class="wybf" style="color: black" class="footer-copytxt">COPYRIGHT <a href="https://beian.miit.gov.cn/"  target="_blank">沪ICP备16029818号-3</a> GBAIE Co., Ltd. All right reserved  <br/>备案号：<a href="http://beian.miit.gov.cn/" target="_blank"><span style="color:black">沪ICP备16029818号-3</span></a>
                    </p>
                    <p class="sjbf" style="color: black;padding-top: 30px;text-align: center;clear: both;width: 90%;padding-left: 30px;" class="footer-copytxt"><a href="https://beian.miit.gov.cn/"  target="_blank">沪ICP备16029818号-3</a> COPYRIGHT <a href="https://beian.miit.gov.cn/"  target="_blank">沪ICP备16029818号-3</a> GBAIE Co., Ltd. All right reserved <br>
                    </p>
            </div>
	</div> 
    
    
<!-- 实现PC端右侧界面侧边栏 -->
    <ul id="scrollSearchDiv" class="rightline wybf" >
    <!--二维码图片div-->
        <li class="li2" ></li>
        <li class="li1" ></li>
        <div class="flex wybf"></div>
    <style type="text/css">
    	.li4::before {
          content:'\e612';
          font-size: 27px;
    	}
    </style>

        <div class="flex1 wybf">

        </div>
        <!--<li class="li4"></li>
        <div class="flex2 wybf"></div>-->
        <li class="li5"></li>
    </ul>
</body>
</html>